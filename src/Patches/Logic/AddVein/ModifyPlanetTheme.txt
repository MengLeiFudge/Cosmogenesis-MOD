using System;
using System.Linq;
using ProjectGenesis.Utils;

namespace ProjectGenesis.Patches.Logic.AddVein
{
    internal static partial class ModifyPlanetTheme
    {
        internal static void ModifyPlanetThemeDataVanilla()
        {
            foreach (ThemeProto theme in LDB.themes.dataArray) ModifyThemeVanilla(theme);
        }

        private static void ModifyThemeVanilla(ThemeProto theme)
        {
            if (theme.PlanetType == EPlanetType.Gas) { GasGiantModify(theme); }
            else
            {
                ModifyThemeData(theme);

                //if (theme.WaterItemId == ProtoID.IÀÆ) theme.WaterItemId = ProtoID.I∫£ÀÆ;

                switch (theme.ID)
                {
                    case 8:
                        theme.WaterItemId = ProtoID.IÀÆ;
                        theme.Distribute = EThemeDistribute.Interstellar;

                        break;

                    case 12:
                        theme.WaterItemId = ProtoID.IœıÀ·;
                        theme.WaterHeight = -0.1f;
                        theme.Distribute = EThemeDistribute.Interstellar;
                        theme.oceanMat = LDB.themes.Select(22).oceanMat;
                        //RemoveVein(theme, 0);
                        //RemoveVein(theme, 1);
                        //RemoveVein(theme, 14);

                        break;

                    case 13:
                        //RemoveVein(theme, 0);
                        //RemoveVein(theme, 14);
                        break;

                    case 17:
                        theme.WaterItemId = ProtoID.I÷ÿ”Õ;
                        theme.WaterHeight = 0.0f;
                        theme.Distribute = EThemeDistribute.Interstellar;
                        theme.Algos = new[] { 3, };
                        theme.oceanMat = LDB.themes.Select(8).oceanMat;
                        //RemoveVein(theme, 0);
                        //RemoveVein(theme, 14);

                        break;
                }
            }
        }

        private static void GasGiantModify(ThemeProto theme)
        {
            if (theme.GasItems.Length != 2) return;

            if (theme.GasItems[0] == ProtoID.Iø…»º±˘ && theme.GasItems[1] == ProtoID.I«‚)
            {
                theme.GasItems = new[] { ProtoID.Iø…»º±˘, ProtoID.I«‚, ProtoID.I∞±, };
                theme.GasSpeeds = new float[] { theme.GasSpeeds[0], theme.GasSpeeds[1], theme.GasSpeeds[1] * 0.7f, };
            }
            else if (theme.GasItems[0] == ProtoID.I«‚ && theme.GasItems[1] == ProtoID.I÷ÿ«‚)
            {
                theme.GasItems = new[] { ProtoID.I«‚, ProtoID.I÷ÿ«‚, ProtoID.I∫§, };
                theme.GasSpeeds = new float[] { theme.GasSpeeds[0], theme.GasSpeeds[1], theme.GasSpeeds[1] * 0.5f, };
            }
        }

        private static void ModifyThemeData(ThemeProto theme)
        {
            if (ThemeDatas.TryGetValue(theme.ID, out ThemeData value))
            {
                theme.RareVeins = theme.RareVeins.Concat(value.RareVeins).ToArray();
                theme.RareSettings = theme.RareSettings.Concat(value.RareSettings).ToArray();
            }
            

            Array.Resize(ref theme.VeinSpot, 15);
            Array.Resize(ref theme.VeinCount, 15);
            Array.Resize(ref theme.VeinOpacity, 15);




            // Coal
            if (theme.PlanetType != EPlanetType.Ocean) 
            {
                if (theme.ID != 17 || theme.ID != 19 || theme.ID != 20)
                {
                    // Aluminum
                    theme.VeinSpot[14] = theme.VeinSpot[5];
                    theme.VeinCount[14] = theme.VeinCount[5];
                    theme.VeinOpacity[14] = theme.VeinOpacity[5];
                    RemoveVein(theme, 5);
                } else
                {
                    RemoveVein(theme, 14);
                }
            }
            else
            {
                theme.VeinSpot[5] += 1;
                theme.VeinCount[5] *= 1.1f;
            }
        }

        private static void RemoveVein(ThemeProto theme, int id)
        {
            theme.VeinSpot[id] = 0;
            theme.VeinCount[id] = 0f;
            theme.VeinOpacity[id] = 0f;
        }
    }
}
